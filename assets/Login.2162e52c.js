import{D as x,h as v,g as O,i as se,j as oe,o as j,c as G,a as g,n as Y,E as ae,G as z,t as V,p as le,m as ue,q as ie,H as re,r as D,k as w,w as P,u as C,z as U,f as ce,I as de,J as W,K as ve,_ as fe}from"./index.53871c04.js";const A=Math.PI;function Q(e,t){return e+t}function me(e){return e*e}function Z(e,t,n,s,a,o){e.beginPath(),e.moveTo(t,n),e.arc(t+s/2,n-a+2,a,.72*A,2.26*A),e.lineTo(t+s,n),e.arc(t+s+a-2,n+s/2,a,1.21*A,2.78*A),e.lineTo(t+s,n+s),e.lineTo(t,n+s),e.arc(t+a-2,n+s/2,a+.4,2.76*A,1.24*A,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e[o](),e.globalCompositeOperation="destination-over"}function pe(e,t){const n=document.createElement("img");return n.crossOrigin="Anonymous",n.onload=t,n.onerror=()=>{n.src=J(e)},n.src=J(e),n}function H(e,t){return Math.round(Math.random()*(t-e)+e)}function J(e){const t=e.length;return t>0?e[H(0,t-1)]:"https://source.unsplash.com/300x150/?book,library"}function he(e,t,n={leading:!0,trailing:!0}){const{leading:s,trailing:a,resultCallback:o}=n;let l=0,d=null;const k=function(...r){return new Promise((c,m)=>{const u=new Date().getTime();!l&&!s&&(l=u);const i=t-(u-l);if(i<=0){d&&(clearTimeout(d),d=null);const f=e.apply(this,r);o&&o(f),c(f),l=u;return}a&&!d&&(d=setTimeout(()=>{d=null,l=s?new Date().getTime():0;const f=e.apply(this,r);o&&o(f),c(f)},i))})};return k.cancel=function(){d&&clearTimeout(d),d=null,l=0},k}function ge(){const e=O({x:0,y:0}),t=v(!1),n=v(!1),s=v(0),a=v([]);return{origin:e,success:t,isMouseDown:n,timestamp:s,trail:a,start:r=>{t.value||(r instanceof MouseEvent?(e.x=r.clientX,e.y=r.clientY):(e.x=r.changedTouches[0].pageX,e.y=r.changedTouches[0].pageY),n.value=!0,s.value=Date.now())},move:(r,c,m)=>{if(!n.value)return!1;let u=0,i=0;if(c instanceof MouseEvent?(u=c.clientX-e.x,i=c.clientY-e.y):(u=c.changedTouches[0].pageX-e.x,i=c.changedTouches[0].pageY-e.y),u<0||u+38>=r)return!1;m(u),a.value.push(i)},end:(r,c)=>{if(!n.value||(n.value=!1,(r instanceof MouseEvent?r.clientX:r.changedTouches[0].pageX)===e.x))return!1;s.value=Date.now()-s.value,c(s.value)},verify:(r,c,m)=>{const u=a.value,i=u.reduce(Q)/u.length,f=u.map(h=>h-i),B=Math.sqrt(f.map(me).reduce(Q)/u.length),E=parseInt(r);return m=m<=1?1:m>10?10:m,{spliced:Math.abs(E-c)<=m,TuringTest:i!==B}}}}var ye=(e,t)=>{const n=e.__vccOpts||e;for(const[s,a]of t)n[s]=a;return n};const Ce=x({name:"SlideVerify",props:{l:{type:Number,default:42},r:{type:Number,default:10},w:{type:Number,default:310},h:{type:Number,default:155},sliderText:{type:String,default:"Slide filled right"},accuracy:{type:Number,default:5},show:{type:Boolean,default:!0},imgs:{type:Array,default:()=>[]},interval:{type:Number,default:50}},emits:["success","again","fail","refresh"],setup(e,{emit:t}){const{imgs:n,l:s,r:a,w:o,h:l,accuracy:d,interval:k}=e,r=v(!0),c=v(0),m=v(0),u=O({containerActive:!1,containerSuccess:!1,containerFail:!1}),i=O({iconCls:"arrow-right",width:"0",left:"0"}),f=v(),B=v(),E=v(),h=v();let y;const{success:I,start:L,move:$,end:M,verify:R}=ge(),N=()=>{var p,_;I.value=!1,u.containerActive=!1,u.containerSuccess=!1,u.containerFail=!1,i.iconCls="arrow-right",i.left="0",i.width="0",f.value.style.left="0",(p=h.value)==null||p.clearRect(0,0,o,l),(_=B.value)==null||_.clearRect(0,0,o,l),f.value.width=o,y.src=J(n)},b=()=>{N(),t("refresh")};function ee(p){i.left=p+"px";let _=(o-40-20)/(o-40)*p;f.value.style.left=_+"px",u.containerActive=!0,i.width=p+"px"}function te(p){const{spliced:_,TuringTest:T}=R(f.value.style.left,c.value,d);if(_){if(d===-1){u.containerSuccess=!0,i.iconCls="success",I.value=!0,t("success",p);return}T?(u.containerSuccess=!0,i.iconCls="success",I.value=!0,t("success",p)):(u.containerFail=!0,i.iconCls="fail",t("again"))}else u.containerFail=!0,i.iconCls="fail",t("fail"),setTimeout(()=>{N()},1e3)}const X=he(p=>{$(o,p,ee)},k),q=p=>{M(p,te)};return se(()=>{var p,_;const T=(p=E.value)==null?void 0:p.getContext("2d"),F=(_=f.value)==null?void 0:_.getContext("2d");h.value=T,B.value=F,y=pe(n,()=>{r.value=!1;const S=s+a*2+3;if(c.value=H(S+10,o-(S+10)),m.value=H(10+a*2,l-(S+10)),T&&F){Z(T,c.value,m.value,s,a,"fill"),Z(F,c.value,m.value,s,a,"clip"),T.drawImage(y,0,0,o,l),F.drawImage(y,0,0,o,l);const K=m.value-a*2-1,ne=F.getImageData(c.value,K,S,S);f.value.width=S,F.putImageData(ne,0,K)}}),document.addEventListener("mousemove",X),document.addEventListener("mouseup",q)}),oe(()=>{document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",q)}),{block:f,canvas:E,loadBlock:r,containerCls:u,sliderBox:i,refresh:b,sliderDown:L,touchStartEvent:L,touchMoveEvent:X,touchEndEvent:q}}}),_e=e=>(le("data-v-f61c42f2"),e=e(),ue(),e),be=["width","height"],we=_e(()=>g("i",{class:"iconfont icon-refresh"},null,-1)),ke=[we],Be=["width","height"],Ee={class:"slide-verify-slider-text"};function Te(e,t,n,s,a,o){return j(),G("div",{id:"slideVerify",class:"slide-verify",style:z({width:e.w+"px"}),onselectstart:"return false;"},[g("div",{class:Y({"slider-verify-loading":e.loadBlock})},null,2),g("canvas",{ref:"canvas",width:e.w,height:e.h},null,8,be),e.show?(j(),G("div",{key:0,class:"slide-verify-refresh-icon",onClick:t[0]||(t[0]=(...l)=>e.refresh&&e.refresh(...l))},ke)):ae("",!0),g("canvas",{ref:"block",width:e.w,height:e.h,class:"slide-verify-block"},null,8,Be),g("div",{class:Y(["slide-verify-slider",{"container-active":e.containerCls.containerActive,"container-success":e.containerCls.containerSuccess,"container-fail":e.containerCls.containerFail}])},[g("div",{class:"slide-verify-slider-mask",style:z({width:e.sliderBox.width})},[g("div",{class:"slide-verify-slider-mask-item",style:z({left:e.sliderBox.left}),onMousedown:t[1]||(t[1]=(...l)=>e.sliderDown&&e.sliderDown(...l)),onTouchstart:t[2]||(t[2]=(...l)=>e.touchStartEvent&&e.touchStartEvent(...l)),onTouchmove:t[3]||(t[3]=(...l)=>e.touchMoveEvent&&e.touchMoveEvent(...l)),onTouchend:t[4]||(t[4]=(...l)=>e.touchEndEvent&&e.touchEndEvent(...l))},[g("i",{class:Y(["slide-verify-slider-mask-item-icon","iconfont",`icon-${e.sliderBox.iconCls}`])},null,2)],36)],4),g("span",Ee,V(e.sliderText),1)],2)],4)}var Fe=ye(Ce,[["render",Te],["__scopeId","data-v-f61c42f2"]]);const Se=""+new URL("logo.1e8c34ec.png",import.meta.url).href,De={class:"login"},Ae={class:"login-form"},Ie={class:"slide-box"},Le={class:"msg"},Me={style:{margin:"16px"}},Ne=x({__name:"Login",setup(e){let t=ie(),n=re(),s=v(""),a=v(""),o=v(!0),l=v(!1);const d=v(""),k=v(""),r=v(1),c=v(),m=()=>{var h;d.value="\u68C0\u6D4B\u5230\u975E\u4EBA\u4E3A\u64CD\u4F5C\u7684\u54E6\uFF01 try again",(h=c.value)==null||h.refresh()},u=h=>{d.value=`login success, \u8017\u65F6${(h/1e3).toFixed(1)}s`,l.value=!0},i=()=>{d.value="\u9A8C\u8BC1\u4E0D\u901A\u8FC7"},f=()=>{d.value="\u70B9\u51FB\u4E86\u5237\u65B0\u5C0F\u56FE\u6807"};let B=()=>{l.value&&(o.value?de(s.value,a.value).then(h=>{h.resultCode==200&&(localStorage.setItem("xftoken",h.data),n.query.needback==1?t.back():t.replace("/home"),W({type:"success",message:"\u767B\u5F55\u6210\u529F"}))}):ve(s.value,a.value).then(h=>{h.resultCode==200&&(W({type:"success",message:"\u6CE8\u518C\u6210\u529F"}),o=!0)}))},E=()=>{t.push("/home")};return(h,y)=>{const I=D("van-icon"),L=D("van-nav-bar"),$=D("van-image"),M=D("van-field"),R=D("van-button"),N=D("van-form");return j(),G("div",De,[g("header",null,[w(L,{title:C(o)?"\u767B\u5F55":"\u6CE8\u518C","left-arrow":"",onClickLeft:C(E)},{right:P(()=>[w(I,{name:"ellipsis",size:"18"})]),_:1},8,["title","onClickLeft"])]),w($,{round:"",class:"logo",src:C(Se)},null,8,["src"]),g("div",Ae,[w(N,{onSubmit:C(B)},{default:P(()=>[w(M,{modelValue:C(s),"onUpdate:modelValue":y[0]||(y[0]=b=>U(s)?s.value=b:s=b),name:"\u7528\u6237\u540D",label:"\u7528\u6237\u540D",placeholder:"\u624B\u673A\u53F7",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u624B\u673A\u53F7"}]},null,8,["modelValue"]),w(M,{modelValue:C(a),"onUpdate:modelValue":y[1]||(y[1]=b=>U(a)?a.value=b:a=b),type:"password",name:"\u5BC6\u7801",label:"\u5BC6\u7801",placeholder:"\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5BC6\u7801"}]},null,8,["modelValue"]),g("div",Ie,[w(C(Fe),{ref_key:"block",ref:c,"slider-text":k.value,accuracy:r.value,onAgain:m,onSuccess:u,onFail:i,onRefresh:f},null,8,["slider-text","accuracy"]),g("div",Le,V(d.value),1)]),g("div",Me,[g("p",{class:"link-register",onClick:y[2]||(y[2]=b=>U(o)?o.value=!C(o):o=!C(o))},V(C(o)?"\u7ACB\u5373\u6CE8\u518C":"\u5DF2\u6709\u8D26\u53F7\uFF0C\u7ACB\u5373\u767B\u5F55"),1),w(R,{round:"",block:"",type:"primary","native-type":"submit"},{default:P(()=>[ce(V(C(o)?"\u767B\u5F55":"\u6CE8\u518C"),1)]),_:1})])]),_:1},8,["onSubmit"])])])}}});const $e=fe(Ne,[["__scopeId","data-v-1e18909a"]]);export{$e as default};
